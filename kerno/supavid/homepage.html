<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupaVid - Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="homepage.html" class="logo">SupaVid</a>
        <div class="nav-links">
            <a href="upload.html">Upload</a>
            <a href="login.html">Login</a>
        </div>
    </nav>

    <div id="video-grid" class="grid">
        <p>Loading videos...</p>
    </div>
    
    <script type="module">
    // We import the library directly from the web to ensure it loads
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // PUT YOUR ACTUAL KEYS HERE DIRECTLY FOR A TEST
    const supabaseUrl = 'https://xnvhixwirbpofdkyhtvf.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhudmhpeHdpcmJwb2Zka3lodHZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMzE0NzgsImV4cCI6MjA4MzgwNzQ3OH0.gg6cLfx1PrGTNKztWSqDy3U9W66mNCu6ln5WDDLpyVo';
    const supabase = createClient(supabaseUrl, supabaseKey);

    async function loadFeed() {
        const grid = document.getElementById('video-grid');
        
        try {
            console.log("Attempting to fetch...");
            const { data: videos, error } = await supabase
                .from('videos')
                .select('*');

            if (error) {
                document.body.insertAdjacentHTML('afterbegin', `<div style="background:red; color:white; padding:20px;">DB ERROR: ${error.message}</div>`);
                return;
            }

            if (!videos || videos.length === 0) {
                grid.innerHTML = "<p>Connected, but 0 videos found. Check RLS Policies!</p>";
                return;
            }

            grid.innerHTML = videos.map(vid => `
                <div style="border:1px solid #333; margin:10px; padding:10px;">
                    <img src="${vid.thumbnail_url || ''}" style="width:100%; max-width:300px;">
                    <h3>${vid.title || 'Untitled'}</h3>
                </div>
            `).join('');

        } catch (err) {
            // This will show a big red box on your phone if the code crashes
            document.body.insertAdjacentHTML('afterbegin', `<div style="background:darkorange; color:white; padding:20px;">CRASH: ${err.message}</div>`);
        }
    }

    loadFeed();
</script>


</body>
</html>
